<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šä¼ å›¾ç‰‡åˆ°GitHubä»“åº“</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            padding: 40px;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8fafc;
        }
        
        .upload-area:hover {
            border-color: #2980b9;
            background-color: #f0f7ff;
        }
        
        .upload-area.dragover {
            border-color: #2ecc71;
            background-color: #e8f6f3;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f1f8ff;
            border-radius: 8px;
            font-size: 14px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        
        .btn {
            background: linear-gradient(to right, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .result {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .links {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .link-btn {
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: opacity 0.3s;
        }
        
        .view-btn {
            background-color: #3498db;
            color: white;
        }
        
        .download-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .link-btn:hover {
            opacity: 0.9;
        }
        
        .instructions {
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            color: #6c757d;
        }
        
        .instructions h3 {
            color: #495057;
            margin-bottom: 10px;
        }
        
        .instructions ol {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¤ ä¸Šä¼ å›¾ç‰‡åˆ°GitHub</h1>
        <p class="subtitle">å®‰å…¨ä¸Šä¼ å›¾ç‰‡åˆ°ä½ çš„ tokenimage ä»“åº“</p>
        
        <!-- æ–‡ä»¶æ‹–æ”¾åŒºåŸŸ -->
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">ğŸ“</div>
            <p><strong>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶ æˆ– æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</strong></p>
            <p>æ”¯æŒ JPG, PNG, GIF, WebP, SVG (æœ€å¤§ 2MB)</p>
            <input type="file" id="fileInput" class="file-input" accept="image/*">
            <div id="fileInfo" class="file-info"></div>
        </div>
        
        <!-- ä¸Šä¼ è¡¨å• -->
        <form id="uploadForm">
            <div class="form-group">
                <label for="pathInput">ä¿å­˜è·¯å¾„ï¼ˆå¯é€‰ï¼‰</label>
                <input type="text" id="pathInput" placeholder="ä¾‹å¦‚: images/2024 æˆ–ç•™ç©ºä¸Šä¼ åˆ°æ ¹ç›®å½•">
            </div>
            
            <button type="submit" id="uploadBtn" class="btn">
                <span>ğŸš€ å¼€å§‹ä¸Šä¼ </span>
            </button>
        </form>
        
        <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div id="result" class="result"></div>
        
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ol>
                <li>ç‚¹å‡»ä¸Šæ–¹åŒºåŸŸé€‰æ‹©å›¾ç‰‡ï¼Œæˆ–ç›´æ¥æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶</li>
                <li>å¯é€‰ï¼šæŒ‡å®šä¿å­˜è·¯å¾„ï¼ˆå¦‚ "images" è¡¨ç¤ºä¿å­˜åˆ° images æ–‡ä»¶å¤¹ï¼‰</li>
                <li>ç‚¹å‡»"å¼€å§‹ä¸Šä¼ "æŒ‰é’®</li>
                <li>ä¸Šä¼ æˆåŠŸåï¼Œå¯ä½¿ç”¨æä¾›çš„é“¾æ¥æŸ¥çœ‹æˆ–ä¸‹è½½å›¾ç‰‡</li>
            </ol>
            <p><strong>æ³¨æ„ï¼š</strong>æ–‡ä»¶å°†ä¸Šä¼ åˆ°ä½ çš„GitHubä»“åº“ <code>tokenimage</code></p>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileInfo = document.getElementById('fileInfo');
        const uploadForm = document.getElementById('uploadForm');
        const uploadBtn = document.getElementById('uploadBtn');
        const pathInput = document.getElementById('pathInput');
        const resultDiv = document.getElementById('result');
        
        // å½“å‰é€‰ä¸­çš„æ–‡ä»¶
        let currentFile = null;
        
        // 1. ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // 2. æ–‡ä»¶é€‰æ‹©å˜åŒ–äº‹ä»¶
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileSelect(e.target.files[0]);
            }
        });
        
        // 3. æ‹–æ”¾åŠŸèƒ½
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length > 0) {
                handleFileSelect(e.dataTransfer.files[0]);
            }
        });
        
        // 4. å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(file) {
            // éªŒè¯æ–‡ä»¶ç±»å‹
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp', 'image/svg+xml'];
            
            if (!allowedTypes.includes(file.type)) {
                showError('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ (JPG, PNG, GIF, WebP, SVG)');
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å° (2MB)
            if (file.size > 2 * 1024 * 1024) {
                showError('æ–‡ä»¶å¤§å°è¶…è¿‡2MBé™åˆ¶');
                return;
            }
            
            currentFile = file;
            
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            fileInfo.innerHTML = `
                <strong>å·²é€‰æ‹©æ–‡ä»¶:</strong> ${file.name}<br>
                <strong>æ–‡ä»¶ç±»å‹:</strong> ${file.type}<br>
                <strong>æ–‡ä»¶å¤§å°:</strong> ${(file.size / 1024).toFixed(2)} KB
            `;
            
            // è‡ªåŠ¨å¡«å……æ–‡ä»¶åï¼ˆä¸å«æ‰©å±•åï¼‰ä½œä¸ºè·¯å¾„æç¤º
            const nameWithoutExt = file.name.substring(0, file.name.lastIndexOf('.'));
            if (!pathInput.value) {
                pathInput.placeholder = `ä¾‹å¦‚: images/${nameWithoutExt}`;
            }
            
            // å¯ç”¨ä¸Šä¼ æŒ‰é’®
            uploadBtn.disabled = false;
        }
        
        // 5. è¡¨å•æäº¤äº‹ä»¶ï¼ˆä¸Šä¼ æ–‡ä»¶ï¼‰
        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentFile) {
                showError('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                return;
            }
            
            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<div class="loading-spinner"></div><span>ä¸Šä¼ ä¸­...</span>';
            
            try {
                // è¯»å–æ–‡ä»¶ä¸ºBase64
                const base64String = await readFileAsBase64(currentFile);
                
                // å‡†å¤‡ä¸Šä¼ æ•°æ®
                const uploadData = {
                    filename: currentFile.name,
                    content: base64String.split(',')[1], // ç§»é™¤ data:image/... å‰ç¼€
                    path: pathInput.value.trim() || undefined
                };
                
                // é‡è¦ï¼šå°† YOUR_VERCEL_APP_URL æ›¿æ¢ä¸ºä½ çš„Vercelåº”ç”¨åœ°å€
                const API_URL = 'https://myupload-ecru.vercel.app/api/upload';
                
                // å‘é€åˆ°Vercel API
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(uploadData)
                });
                
                const result = await response.json();
                console.log(result)
                if (response.ok && result.success) {
                    showSuccess(result);
                } else {
                    showError(result.error || result.details || 'ä¸Šä¼ å¤±è´¥');
                }
                
            } catch (error) {
                console.error('ä¸Šä¼ é”™è¯¯:', error);
                showError(`ç½‘ç»œé”™è¯¯: ${error.message}`);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<span>ğŸš€ å¼€å§‹ä¸Šä¼ </span>';
            }
        });
        
        // 6. è¯»å–æ–‡ä»¶ä¸ºBase64
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // 7. æ˜¾ç¤ºæˆåŠŸç»“æœ
        function showSuccess(result) {
            resultDiv.className = 'result success';
            resultDiv.style.display = 'block';
            
            const actionText = result.action === 'updated' ? 'æ›´æ–°' : 'ä¸Šä¼ ';
          
            resultDiv.innerHTML = `
                <h3>âœ… æ–‡ä»¶${actionText}æˆåŠŸï¼</h3>
                <p><strong>æ–‡ä»¶:</strong> ${result.data.filename}</p>
                <p><strong>è·¯å¾„:</strong> ${result.data.path}</p>
                <p><em>${result.action === 'updated' ? 'âš ï¸ å·²è¦†ç›–åŒåæ–‡ä»¶' : 'âœ… æ–°æ–‡ä»¶å·²åˆ›å»º'}</em></p>
                
                <div class="links">
                    <a href="${result.data.htmlUrl}" target="_blank" class="link-btn view-btn">
                        ğŸ‘ï¸ åœ¨GitHubæŸ¥çœ‹
                    </a>
                    <a href="${result.data.downloadUrl}" target="_blank" class="link-btn download-btn">
                        â¬‡ï¸ ä¸‹è½½æ–‡ä»¶
                    </a>
                </div>
            `;
            
            // é‡ç½®è¡¨å•
            currentFile = null;
            fileInput.value = '';
            fileInfo.innerHTML = '';
            pathInput.value = '';
        }
        
        // 8. æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            resultDiv.className = 'result error';
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <h3>âŒ ä¸Šä¼ å¤±è´¥</h3>
                <p>${message}</p>
            `;
            
            // 3ç§’åè‡ªåŠ¨éšè—é”™è¯¯
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 5000);
        }
        
        // åˆå§‹çŠ¶æ€ï¼šç¦ç”¨ä¸Šä¼ æŒ‰é’®
        uploadBtn.disabled = true;
    </script>
</body>
</html>
