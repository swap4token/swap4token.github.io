<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>å…¬å¹³å‘å°„é¡¹ç›®ç®¡ç†</title>
    <link href="css/mdui.min.css" rel="stylesheet">
	<link href="css/me.css" rel="stylesheet">
	
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "PingFang SC", "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background-color: #f5f3ff;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #4a2380, #6c2bd9);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-radius: 0 0 15px 15px;
            position: relative;
        }
        
        .back-btn {
            position: absolute;
            left: 15px;
            top: 15px;
            color: white;
            text-decoration: none;
            font-size: 18px;
        }

        .page-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #4a2380;
        }
        
        .form-group {
            margin-bottom: 15px;
        }

        /* ä¸€è¡Œä¸¤åˆ—å¸ƒå±€ */
        .form-row {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            font-family: monospace;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #6c2bd9;
        }
        
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            color: #333;
            min-height: 100px;
            resize: vertical;
        }
        
        /* Logoæ ·å¼ä¼˜åŒ– - ä¸è¾“å…¥æ¡†å¹³é½ */
        .logo-group {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }
        .logo-input-wrap {
            flex: 1;
        }
        .logo-display {
            width: 55px;
            height: 55px;
            border-radius: 12px;
            background-color: #f0f0f0;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            flex-shrink: 0;
            margin-top: 20px;
        }
        .logo-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: linear-gradient(135deg, #4a2380, #6c2bd9);
            color: white;
        }
        .btn-secondary {
            background-color: #f0f0f0;
            color: #666;
        }
        .btn-danger {
            background-color: #ff6b6b;
            color: white;
        }
        .btn-full {
            width: 100%;
            padding: 12px;
            font-size: 16px;
        }
        .btn-center {
            display: block;
            margin: 0 auto;
            width: 120px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-tag {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-running {
            background-color: #e8f4fd;
            color: #4299e1;
        }
        .status-ended {
            background-color: #f0f0f0;
            color: #999;
        }

        /* æ•°æ®ç»Ÿè®¡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .stats-item {
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 8px;
            text-align: center;
        }
        .stats-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }
        .stats-value {
            font-size: 16px;
            font-weight: bold;
            color: #4a2380;
        }

        /* ç®¡ç†å‘˜ä¿¡æ¯æ ·å¼ */
        .admin-info {
            padding: 12px;
            background-color: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .admin-address {
            font-family: monospace;
            font-size: 14px;
            color: #4a2380;
            word-break: break-all;
        }
        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* å°å­—è¯´æ˜ */
        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 8px;
        }

        /* äº¤æ˜“ç¨è¯´æ˜ */
        .tax-info {
            padding: 12px;
            background-color: #f8f8f8;
            border-radius: 8px;
            margin-top: 10px;
        }
        .tax-title {
            font-size: 14px;
            font-weight: bold;
            color: #4a2380;
            margin-bottom: 8px;
        }
        .tax-list {
            font-size: 13px;
            color: #666;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="header1 flex justify-between align-center" style="background-color: #fff;color: #4a2380;padding: 12px;box-shadow: 0 2px 10px rgba(108, 43, 217, 0.15);">
    		<div class="flex justify-start align-center" style="">
    			<div class="flex justify-start align-center">
    				<img id="logjs" src="img/logo.png" alt="" style="display: block;width: 40px;">
    				<span class=" mdui-typo-subheading" style="font-weight: 800;padding-left: 2px;">BPMWEB3</span>
    			</div>
    		</div>
    		<div class="flex justify-end align-center">
    			<span onclick="copyAddress()"
    				class="copyBtn btnbg mdui-p-a-1 mdui-color-amber1 mdui-p-x-2 mdui-m-r-1"
    				style="font-weight: 550;border-radius: 8px;border: rgba(108, 43, 217, 0.1) 1px solid;">
    			    ğŸ”<span id="selectAddress" style="padding-left: 2px;">â€¦â€¦</span>
    			</span>
    			<!-- <div id="playBtn"  class="mdui-color-amber mdui-ripple cuIconfont-spin" onclick="changeStats()" style="float: right;border-radius: 50%;width: 30px;height: 30px;text-align: center;line-height: 30px;"><i class="mdui-icon material-icons mdui-text-color-white">music_note</i></div> -->
    		</div>
    </div>
    
    <div class="container">
        <!-- é¡¹ç›®åŸºç¡€ä¿¡æ¯ -->
        <div class="card">
            <div class="card-title">
                <i>ğŸ“‹</i> é¡¹ç›®åŸºç¡€ä¿¡æ¯
                <span class="status-tag status-running" style="margin-left: auto;"></span>
            </div>
            
            
            <div class="form-group">
                <label onclick="copyContract()" class="form-label copyBtn">åˆçº¦åœ°å€ <i class="mdui-icon material-icons" style="font-size: 14px;">&#xe14d;</i></label>
                <input id="tokenContract" type="text" class="form-input" style="font-size: 12px;" value="" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">é¡¹ç›®åç§°</label>
                <input id="tokenName" type="text" class="form-input" value="" readonly>
            </div>
            <!-- ä»£å¸ç¬¦å· + å‘è¡Œé‡ åŒè¡Œ -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ä»£å¸ç¬¦å·</label>
                    <input id="tokenSymbol" type="text" class="form-input" value="" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">å‘è¡Œé‡</label>
                    <input id="tokenTotal" type="number" class="form-input" value="" readonly>
                </div>
            </div>
            
            <!-- é¡¹ç›®æè¿°åœ¨ä¸Šï¼ŒLogoåœ¨ä¸‹ -->
            <div class="form-group">
                <label class="form-label">é¡¹ç›®æè¿°</label>
                <textarea id="tokenContext" class="form-textarea" readonly></textarea>
            </div>
            
            <div class="logo-group">
                <div class="logo-input-wrap">
                    <label class="form-label">ä»£å¸Logo</label>
                    <input type="file" class="form-input" id="tokenLogoUpload" accept="image/*">
                </div>
                <div class="logo-display" id="tokenLogoDisplay">
                    <img id="tokenImage" src="img/none.png"  onerror="this.src='./img/none.png'" alt="ä»£å¸Logo">
                </div>
            </div>
        </div>
        

        <!-- äº¤æ˜“ç¨æ¿å— -->
        <div class="card">
            <div class="card-title">
                <i>ğŸ“‰</i> äº¤æ˜“ç¨è®¾ç½®
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ä¹°ç¨</label>
                    <input id="tokenBuyFee" type="number" class="form-input" value="30">
                </div>
                <div class="form-group">
                    <label class="form-label">å–ç¨</label>
                    <input id="tokenSellFee" type="number" class="form-input" value="30">
                </div>
            </div>

            <div class="tax-info">
                <strong>ç¨ç‡è¯´æ˜ï¼š</strong>
                <div>ç¨ç‚¹ä¸ºåƒåˆ†åˆ¶</div>
                <div>ä¹°ç¨<span id="tokenBuyFeeInfo"></span>è¡¨ç¤º<span id="tokenBuyFeePersent"></span>%</div>
                <div>å–ç¨<span id="tokenSellFeeInfo"></span>è¡¨ç¤º<span id="tokenSellFeePersent"></span>%</div>
            </div>
            <div class="admin-actions">
                <button class="btn btn-primary btn-full" onclick="setSwapFeeCheck()">ä¿®æ”¹</button>
            </div>
        </div>
        
        <!-- æ—¶é—´é…ç½®ä¿®æ”¹ -->
        <div class="card">
            <div class="card-title">
                <i>â°</i> æ—¶é—´é…ç½®ä¿®æ”¹
            </div>
            <div class="form-group">
                <label class="form-label">å½“å‰å¼€ç›˜æ—¶é—´</label>
                <input id="tokenOldStartTime" type="text" step="1" class="form-input" value="" style="background:#eee" readonly>
            </div>
            <div class="form-group">
                <label class="form-label">è®¾ç½®æ–°å¼€ç›˜æ—¶é—´</label>
                <input id="tokenSwapTime" type="datetime-local" step="1" class="form-input" style="background:#fff" readonly>
            </div>
            <button class="btn btn-primary btn-full" onclick="setTokenStartTimeCheck()">ä¿å­˜æ—¶é—´ä¿®æ”¹</button>
            <div class="help-text">
                è¯´æ˜ï¼šè®¾ç½®å¼€ç›˜æ—¶é—´ï¼Œåˆ°è®¾ç½®çš„æ—¶å€™è‡ªåŠ¨å¼€å¯äº¤æ˜“ã€‚
            </div>
        </div>

        <!-- ç™½åå•ç®¡ç† -->
        <div class="card">
            <div class="card-title">
                <i>ğŸ”‘</i> ç™½åå•ç®¡ç†
            </div>
            <div class="form-group">
                <label class="form-label">é’±åŒ…åœ°å€</label>
                <input type="text" class="form-input" placeholder="è¾“å…¥0xå¼€å¤´çš„é’±åŒ…åœ°å€" id="whitelistAddress">
            </div>
            <div class="admin-actions">
                <button class="btn btn-primary btn-full" onclick="setExcludedFromFeesCheck(true)">æ·»åŠ ç™½åå•</button>
                <button class="btn btn-danger btn-full" onclick="setExcludedFromFeesCheck(false)">å–æ¶ˆç™½åå•</button>
            </div>
        </div>

        <!-- ä»£å¸ç®¡ç†å‘˜åŠæƒé™ç®¡ç† -->
        <div class="card">
            <div class="card-title">
                <i>ğŸ‘‘</i> ä»£å¸ç®¡ç†å‘˜æƒé™
            </div>
            <div class="admin-info">
                <div class="form-label">å½“å‰ç®¡ç†å‘˜åœ°å€</div>
                <div id="oldAdminAddress" class="admin-address">0x1234567890abcdef1234567890abcdef12345678</div>
            </div>
            <div class="form-group">
                <label class="form-label">è½¬ç§»æƒé™è‡³æ–°åœ°å€</label>
                <input type="text" class="form-input" placeholder="è¾“å…¥æ–°ç®¡ç†å‘˜é’±åŒ…åœ°å€" id="newAdminAddress">
            </div>
            <div class="admin-actions">
                <button class="btn btn-primary btn-full"  onclick="transferOwnershipCheck()">è½¬ç§»ç®¡ç†å‘˜æƒé™</button>
            </div>
            <div class="admin-actions" style="margin-top: 10px;">
                <button class="btn btn-danger btn-full"  onclick="renounceOwnership()">ä¸¢å¼ƒç®¡ç†å‘˜æƒé™</button>
            </div>
            <p style="font-size: 12px; color: #ff6b6b; margin-top: 10px;">âš ï¸ ä¸¢å¼ƒæƒé™åå°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼</p>
        </div>

        <!-- é¡¹ç›®èµ„é‡‘æ± ç®¡ç† -->
        <div class="card">
            <div class="card-title">
                <i>ğŸš€</i> é¡¹ç›®èµ„é‡‘æ± ç®¡ç†
            </div>
            <div style="padding: 15px; background-color: #e8f4fd; border-radius: 8px; margin-bottom: 15px;">
                <p style="font-size: 14px; color: #4299e1; margin-bottom: 5px;">
                    <i>âš ï¸ æ“ä½œæç¤ºï¼šèµ„é‡‘æ± ä¸Šé”æ—¶é—´å‰©ä½™,å½“å‰èµ„é‡‘æ± å‰©ä½™ï¼š<b><span id="tokenPairNowUsdtAmount">0.0</span></b> USDT
                    <div id="launchCountdown" class="mdui-text-center mdui-p-b-1">
                        <b>0</b>å¤© <b>6</b>æ—¶ <b>0</b>åˆ† <b>0</b>ç§’</i>
                    </div>
                </p>
                <p style="font-size: 12px; color: #666;">ç»“æŸé¡¹ç›®ï¼Œå¯è·å¾—<b><span id="userCanSendAmount">0.0</span></b>USDTå¥–åŠ±åˆ°é¡¹ç›®æ–¹ç®¡ç†é’±åŒ…ã€‚</p>
            </div>
            <button class="btn btn-danger btn-full" id="endIDOBtn" onclick="lockLdxCheck()">å»¶é•¿èµ„é‡‘æ± ä¸Šé”æ—¶é—´</button>
            <button class="btn btn-secondary btn-full" style="margin-top: 10px;" onclick="deleteLdxCheck()">ç»“æŸé¡¹ç›®</button>
        </div>
    </div>

    <script>
        // æœ€å¤§å°ºå¯¸é™åˆ¶
        const MAX_WIDTH = 96;
        const MAX_HEIGHT = 96;
        
        // è·å–DOMå…ƒç´ 
        const fileInput = document.getElementById('tokenLogoUpload');
        const previewDiv = document.getElementById('tokenLogoDisplay');
        // const statusDiv = document.getElementById('message');
        
        // ç›‘å¬æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', handleFileSelect);
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆå¯é€‰ï¼‰
            const maxSize = 5 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                tishi("å›¾ç‰‡å¤ªå¤§")
                return;
            }
            
            // å¤„ç†å›¾ç‰‡å¹¶ä¸Šä¼ 
            processAndUploadImage(file);
        }
        
        // å¤„ç†å›¾ç‰‡å¹¶ä¸Šä¼ 
        async function processAndUploadImage(file) {
            try {
                // 1. åŠ è½½å›¾ç‰‡
                const image = await loadImage(file);
                
                // 2. è°ƒæ•´å›¾ç‰‡å°ºå¯¸
                const resizedData = await resizeImage(image);
                
                // 3. æ˜¾ç¤ºé¢„è§ˆ
                showPreview(resizedData);
                
                // 4. ä¸Šä¼ å›¾ç‰‡
                await uploadImage(resizedData.blob, tokenContractAddress+".png");
                
            } catch (error) {
                console.error('å¤„ç†å›¾ç‰‡å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½å›¾ç‰‡
        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                const img = new Image();
                
                reader.onload = function(e) {
                    img.onload = () => resolve(img);
                    img.onerror = () => reject(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'));
                    img.src = e.target.result;
                };
                
                reader.onerror = () => reject(new Error('è¯»å–æ–‡ä»¶å¤±è´¥'));
                reader.readAsDataURL(file);
            });
        }
        
        // è°ƒæ•´å›¾ç‰‡å°ºå¯¸
        function resizeImage(image) {
            return new Promise((resolve, reject) => {
                try {
                    // éªŒè¯å›¾ç‰‡æ˜¯å¦æœ‰æ•ˆ
                    if (!image.complete || image.naturalWidth === 0) {
                        reject(new Error('å›¾ç‰‡æ— æ•ˆæˆ–æœªåŠ è½½å®Œæˆ'));
                        return;
                    }
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // è·å–åŸå§‹å°ºå¯¸
                    const originalWidth = image.naturalWidth || image.width;
                    const originalHeight = image.naturalHeight || image.height;
                    
                    // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                    let width = originalWidth;
                    let height = originalHeight;
                    
                    if (width > MAX_WIDTH || height > MAX_HEIGHT) {
                        const ratio = Math.min(
                            MAX_WIDTH / width,
                            MAX_HEIGHT / height
                        );
                        width = Math.floor(width * ratio);
                        height = Math.floor(height * ratio);
                    }
                    
                    // è®¾ç½®canvaså°ºå¯¸
                    canvas.width = width;
                    canvas.height = height;
                    
                    // ç»˜åˆ¶è°ƒæ•´åçš„å›¾ç‰‡
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(image, 0, 0, width, height);
                    
                    // è½¬æ¢ä¸ºBlobï¼ˆä½¿ç”¨JPEGæ ¼å¼ï¼Œè´¨é‡80%ï¼Œæ–‡ä»¶æ›´å°ï¼‰
                    canvas.toBlob((blob) => {
                        if (!blob) {
                            reject(new Error('è½¬æ¢ä¸ºBlobå¤±è´¥'));
                            return;
                        }
                        
                        resolve({
                            blob: blob,
                            width: width,
                            height: height,
                            originalWidth: originalWidth,
                            originalHeight: originalHeight,
                            url: URL.createObjectURL(blob)
                        });
                        
                    }, 'image/jpeg', 0.8); // å¯ä»¥æ”¹ä¸º 'image/png' å¦‚æœéœ€è¦é€æ˜èƒŒæ™¯
                    
                } catch (error) {
                    reject(new Error(`è°ƒæ•´å›¾ç‰‡å°ºå¯¸å¤±è´¥: ${error.message}`));
                }
            });
        }
        
        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview(resizedData) {
            previewDiv.innerHTML = '';
            const img = document.createElement('img');
            img.src = resizedData.url;
            previewDiv.appendChild(img);
            // è®°å¾—ç¨åæ¸…ç†URLå¯¹è±¡
            setTimeout(() => {
                URL.revokeObjectURL(resizedData.url);
            }, 1000);
        }
        
        // ä¸Šä¼ å›¾ç‰‡
        async function uploadImage(blob, originalFilename) {
            // åˆ›å»ºFormData
            const formData = new FormData();
            
            // ç”Ÿæˆæ–°æ–‡ä»¶åï¼ˆä¿ç•™åŸæ‰©å±•åï¼‰
            const extension = originalFilename.split('.').pop();
            const newFilename = `resized_${Date.now()}.${extension}`;
            
            formData.append('image', blob, newFilename);
            formData.append('filename', originalFilename);
            formData.append('overwrite', '1'); // ä¼ é€’è¦†ç›–é€‰é¡¹
            // å‘é€åˆ°æœåŠ¡å™¨ä¸Šçš„ upload.php æ–‡ä»¶
            fetch('upload.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.overwritten) {
                    } else {
                    }
                } else {
                }
            })
            .catch(error => {
                console.error('å‘ç”Ÿé”™è¯¯:', error);
            });
        }
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
<script src="js/clipboard.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/mdui.js" type="text/javascript" charset="utf-8"></script>
<script src="js/web3.min.js" type="text/javascript" charset="utf-8"></script> 
<script src="js/datetime-picker-module.js"></script>
<script src="js/create/CreateTokenTool.js" type="text/javascript" charset="utf-8"></script>
<script src="js/create/FairBeginTokenDetail.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	var $ = mdui.$;
    DateTimePickerModule.init({inputId: 'tokenSwapTime'});
</script>